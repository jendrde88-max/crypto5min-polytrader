# NOTE: This file is intentionally identical to the root `.env.example`.
#
# Customers and the Setup Wizard use `config/.env` as the real config file.
# Shipping `config/.env.example` in release ZIPs makes it easy to:
#   1) copy -> config/.env
#   2) edit values
#   3) restart the bot

# ============================================================
# Crypto5min PolyTrader — Configuration
# ============================================================
#
# HOW TO USE THIS FILE:
# 1. Copy this file to config/.env  (the Setup Wizard does this for you)
# 2. Fill in the values you need (most have good defaults)
# 3. Lines starting with # are comments (ignored by the bot)
# 4. After changing anything, restart: docker compose restart
#
# DON'T KNOW WHAT SOMETHING MEANS?
# Check SETUP_GUIDE.md or the "How It Works" tab on the dashboard.
# ============================================================

# --- Dashboard ---
# The password you use to log into the web dashboard.
# Set this during the Setup Wizard, or type one here manually.
C5_DASHBOARD_PASSWORD=
C5_DASHBOARD_HOST=0.0.0.0
C5_DASHBOARD_PORT=8601
# Public port on your machine/VPS (Docker maps this -> C5_DASHBOARD_PORT).
# If you already have another dashboard on 8602 (e.g., copybot), set this to 8603.
C5_DASHBOARD_PUBLIC_PORT=8602
# Comma-separated IP allowlist (optional). Example: 1.2.3.4,5.6.7.8
C5_DASHBOARD_ALLOWED_IPS=

# --- Market ---
# Which cryptocurrency to track. Uses Coinbase format: BASE-QUOTE
# Examples: BTC-USD, ETH-USD, SOL-USD
C5_SYMBOL=BTC-USD

# Optional multi-symbol mode (comma-separated). If set, the dashboard will show signals for all symbols.
# You can also change this from the dashboard Controls panel (saved in logs/runtime_config.json).
C5_SYMBOLS=

# 5-minute candles = 300 seconds
C5_GRANULARITY_SECONDS=300
C5_LOOKBACK_DAYS=30

# --- Model ---
# Retrain cadence
C5_RETRAIN_MINUTES=60

# Confidence threshold for a "strong" signal
C5_CONFIDENCE_THRESHOLD=0.55

# Direction threshold for calling UP vs DOWN (default 0.50)
# UP if p_up >= this value, else DOWN.
C5_DIRECTION_THRESHOLD=0.50

# --- Paper trading ---
# Paper mode = fake money, no real trades. Great for testing.
# Change C5_MODE to "polymarket" when you're ready for real trading.
C5_MODE=paper
C5_PAPER_STARTING_CASH=10000
# Fee + slippage are in basis points (bps). 10 bps = 0.10%
C5_PAPER_FEE_BPS=10
C5_PAPER_SLIPPAGE_BPS=5

# Fraction of available cash to deploy on each signal (0..1)
C5_PAPER_POSITION_FRACTION=1.0

# --- Ops ---
C5_LOG_LEVEL=INFO

# --- Optional: Gas top-up (ADVANCED) ---
# The dashboard can (optionally) swap a small amount of USDC.e into Polygon gas
# using 0x Swap API v2.
#
# IMPORTANT:
# - This still requires some existing native gas to send the approval/swap tx.
# - Leave disabled unless you understand the risks.
C5_ZEROX_API_KEY=
C5_GAS_TOPUP_ENABLED=false
# Target native gas balance (e.g., 1.0 = try to top up until you have ~1 MATIC/POL).
C5_GAS_TOPUP_TARGET_NATIVE=1.0
# Hard cap on USDC.e spend per top-up.
C5_GAS_TOPUP_MAX_USDC=5
# If your gas is below this, the bot will refuse to attempt a swap.
C5_GAS_TOPUP_MIN_NATIVE_FOR_SWAP=0.02

# --- Optional: Polymarket auto-trading (ADVANCED) ---
# This section lets the bot place REAL trades on Polymarket.
# Disabled by default. To enable:
#   1. Set C5_MODE=polymarket (in the Paper trading section above)
#   2. Add your private key below
#   3. Keep C5_POLY_DRY_RUN=true until you're confident it works
#   4. Fund your wallet with USDC + POL on Polygon
#
# Your private key NEVER leaves this file. It stays on YOUR server only.

# (C5_MODE is set above in the Paper trading section)

# Dry run = the bot will choose markets and compute orders but NOT place them.
C5_POLY_DRY_RUN=true

# CLOB endpoints
C5_POLY_GAMMA_URL=https://gamma-api.polymarket.com
C5_POLY_CLOB_URL=https://clob.polymarket.com

# Credentials (required for live trading)
C5_POLY_PRIVATE_KEY=

# Signature type and funder address:
# See: https://docs.polymarket.com/developers/CLOB/authentication
# - MetaMask / browser wallet: signature type 0, funder blank
# - Email/Google wallet: signature type 1, funder = Polymarket profile address
# - IMPORTANT: funder is a wallet address (0x + 40 hex chars), NOT your private key
# - IMPORTANT: for proxy wallets, funder should be DIFFERENT from the address derived from your private key
C5_POLY_SIGNATURE_TYPE=0
C5_POLY_FUNDER_ADDRESS=

# Builder Relayer credentials (required for email/Google/magic-link wallet users).
# These allow gasless on-chain redemption via the Polymarket Builder Relayer API.
# If you log in with MetaMask/Coinbase Wallet (signature type 0), leave these blank.
# If you log in with email or Google (signature type 1), set all three below.
# Obtain credentials from the Polymarket team or your account dashboard.
C5_POLY_BUILDER_API_KEY=
C5_POLY_BUILDER_SECRET=
C5_POLY_BUILDER_PASSPHRASE=

# Market selection: we will pick the first active market whose question contains this string.
C5_POLY_MARKET_QUERY=Bitcoin Up or Down

# Outcome labels to map to the market's outcomes list.
C5_POLY_OUTCOME_UP=Up
C5_POLY_OUTCOME_DOWN=Down

# 5-minute slug-based market discovery (recommended, default).
# Uses deterministic slugs like btc-updown-5m-{unix_ts} to find markets.
# Set to false to fall back to text-search discovery.
C5_POLY_USE_5MIN_SLUG=true

# How many seconds after a window opens to place the trade (default 30).
# The bot waits this long to ensure the market exists on Gamma before trading.
C5_POLY_TRADE_LEAD_SECONDS=30

# Time sync (v0.4.16+): align 5-minute window slugs to Polymarket's CLOB server time.
# This prevents "previous cycle" trades when the host clock is drifting (common on
# Windows/WSL/VPS after sleep/resume).
#
# If disabled, window selection uses local wall-clock time (time.time()).
C5_POLY_TIME_SYNC_ENABLED=true

# Risk / rate limits
C5_POLY_MAX_USDC_PER_TRADE=5
C5_POLY_COOLDOWN_SECONDS=300

# Bet sizing:
#   - 'fixed' uses MAX_USDC_PER_TRADE as a flat amount.
#   - 'percent' uses BET_PERCENT % of your CLOB balance (capped at MAX_USDC).
#   - 'kelly' uses Fractional Kelly based on (model probability p) vs (market price P).
#     Default is 1/4 Kelly.
C5_POLY_BET_MODE=fixed
C5_POLY_BET_PERCENT=5

# Fractional Kelly multiplier (0.0–1.0). Common values:
#   - 0.25 = 1/4 Kelly (recommended)
#   - 0.125 = 1/8 Kelly (more conservative)
# NOTE: With accurate live CLOB pricing (v0.1.8+), Kelly often finds "no edge"
#       because model confidence (~52-55%) is close to market price. If the bot
#       keeps skipping trades, switch to 'percent' mode (5-10%) instead.
C5_POLY_KELLY_FRACTION=0.25

# Risk rail: by default, percent sizing is capped (max 10%).
# Set true to unlock up to 50% sizing (still dangerous).
C5_POLY_HIGH_RISK_MODE=false

# Expert/UNSAFE mode: removes the % sizing cap (allows up to 100%).
# Extremely dangerous — you can lose everything quickly.
C5_POLY_EXPERT_MODE=false

# Order safety
# Auto-cancel open/partial orders that have not completed after N seconds.
C5_POLY_AUTO_CANCEL_STALE=true
C5_POLY_ORDER_TIMEOUT_SEC=120

# --- Order execution (v0.1.8+) ---
# Live CLOB pricing: the bot fetches the real-time best ask from Polymarket's
# orderbook instead of using stale Gamma API data. These settings control
# the fill-or-retry loop:
#
# Price buffer: worst-case ceiling above best ask for FOK market orders.
# You pay the best available price; this caps the maximum.
# (v0.4.8: raised from 0.02 to 0.40 — FOK fills at market, this is just the cap.)
C5_POLY_PRICE_BUFFER=0.40
# Fill retry (GTC fallback only): if FOK fails and GTC fallback triggers,
# the order retries up to FILL_MAX_ATTEMPTS times with FILL_RETRY_BUMP each.
C5_POLY_FILL_MAX_ATTEMPTS=3
C5_POLY_FILL_WAIT_SEC=20
C5_POLY_FILL_RETRY_BUMP=0.02
# Minimum shares per order (Polymarket CLOB minimum is 5).
# Orders below this are auto-bumped to meet the minimum.
C5_POLY_MIN_SHARES=5

# Thin orderbook guard (v0.4.17+)
# If enabled, the bot will SKIP placing an order when there isn't enough
# cumulative liquidity on the ask side to fill your intended USDC size (plus a
# cushion) up to the FOK worst-price cap.
#
# This prevents "W unfilled" / "L unfilled" outcomes caused by thin books.
#
# Fast + safe defaults:
# - require depth = true
# - depth mult = 1.10 (require 10% extra depth to reduce snapshot staleness)
C5_POLY_REQUIRE_BOOK_DEPTH=false
C5_POLY_BOOK_DEPTH_MULT=1.10

# --- Arb-first (binary complement arb) ---
# If enabled, the bot will attempt to buy BOTH sides (UP + DOWN) when top-of-book
# asks sum to < $1 with enough edge (after fee/slippage buffers).
#
# This is the highest-confidence style of trade when it triggers, but it depends
# on real-time orderbook conditions and may not trigger often.
C5_POLY_ARB_ENABLED=false
# Minimum edge required, in cents per $1 bundle (default 1.0¢).
C5_POLY_ARB_MIN_EDGE_CENTS=1.0
# Optional fee/slippage buffers (basis points). Some Polymarket market types
# charge taker fees (e.g., 15-min crypto ~156bps at $0.50 price). 5-min crypto
# markets are currently fee-free (Feb 2026), but keep this as a safety buffer.
C5_POLY_ARB_TAKER_FEE_BPS=150
C5_POLY_ARB_SLIPPAGE_BPS=0

# --- Snipe mode (late-entry window-delta strategy) ---
# Instead of predicting direction *before* the window, snipe mode waits until
# the final seconds and checks whether BTC has already moved vs the window
# open price.  When the move is large enough, the direction is mostly locked in.
#
# This is a separate pass — it does NOT replace the normal ML prediction.
# If the ML trade already fired earlier in the window, snipe will not duplicate.
# ON by default since v0.3.0 — highest-accuracy strategy (~80-90%+).
C5_SNIPE_ENABLED=true
# How many seconds before window close to check (default 10).
C5_SNIPE_LEAD_SECONDS=10
# Minimum |price move| in % to trigger (default 0.02 = 0.02%).
C5_SNIPE_MIN_DELTA_PCT=0.02
# Snipe bet multiplier: snipe trades bet N× normal size.
# Because snipe accuracy (~80-90%) is much higher than ML (~55%),
# it makes sense to bet more on snipe trades. Min value: 1.0.
# Changeable from the dashboard without restart.
C5_POLY_SNIPE_BET_MULTIPLIER=2.0

# --- Delta-first strategy (v0.5.0+) ---
# When enabled (default), the ML model is NOT used for trade entry — only the
# live Chainlink delta at T-10s (snipe) triggers trades.  This was validated by
# the most profitable open-source Polymarket bot (Archetapp: $313 → $414k).
# Set to false to restore the pre-v0.5.0 ML+snipe hybrid behaviour.
C5_DELTA_FIRST=true

# Delta-based price gate — before placing a snipe FOK order, the bot compares
# the live ask against a tier derived from the observed Chainlink delta magnitude.
# If the ask exceeds the tier, the trade is skipped (too expensive for the signal).
# If the ask is at or below the tier, the FOK executes at standard ask+buffer pricing.
#
# Each tier is independently tunable:
#   T1 = max ask when delta < 0.01%  (near-random, require cheapest entry)
#   T2 = max ask when delta < 0.02%
#   T3 = max ask when delta < 0.05%
#   T4 = max ask when delta < 0.10%
#   T5 = max ask when delta >= 0.10% (strong signal, most permissive)
C5_DELTA_PRICING=true
# C5_DELTA_PRICE_T1=0.52
# C5_DELTA_PRICE_T2=0.58
# C5_DELTA_PRICE_T3=0.68
# C5_DELTA_PRICE_T4=0.82
# C5_DELTA_PRICE_T5=0.97

# Best-effort post-resolution cleanup
# NOTE: this is NOT on-chain redeem/claim. It attempts to close resolved exposure via SELL orders.
C5_POLY_AUTO_CLOSE_RESOLVED=true
C5_POLY_SETTLE_RETRY_MINUTES=60
C5_POLY_MAX_SETTLE_TRADES_PER_RUN=10

# On-chain redeem/claim (EOA-only)
# After a market resolves, winnings must be redeemed on-chain via CTF.
# This sends a Polygon tx and costs gas.
C5_POLY_AUTO_REDEEM_ENABLED=true
C5_POLY_REDEEM_RETRY_MINUTES=60
C5_POLY_MAX_REDEEM_TRADES_PER_RUN=5

# --- Optional: Emergency actions (VERY ADVANCED) ---
# Disabled by default. If enabled, the dashboard can attempt to place SELL orders
# to close all active positions.
C5_POLY_SELL_ALL_ENABLED=false

# --- Optional: Withdraw (VERY ADVANCED) ---
# Disabled by default. If enabled, the dashboard can send USDC.e from the bot
# EOA wallet (C5_POLY_PRIVATE_KEY) to your personal wallet.
#
# Safety notes:
# - This only works for simple EOA wallets, not Safe/multisig setups.
# - Always set a conservative max.
C5_WITHDRAW_ENABLED=false
C5_WITHDRAW_TO_ADDRESS=
C5_WITHDRAW_MAX_USDC=100
# Polygon RPC used for on-chain withdraw/balance checks.
C5_POLYGON_RPC=https://polygon-bor-rpc.publicnode.com
# USDC.e on Polygon (default)
C5_WITHDRAW_USDC_ADDRESS=0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174

# --- Risk Rails — circuit breakers for capital protection (v0.3.0+) ---
# Automated guardrails that pause trading when things go wrong.
# All limits are checked BEFORE each trade. Safe defaults are provided.

# Pause after losing X% of balance in a rolling 24-hour window (0 = disabled).
C5_RISK_DAILY_LOSS_PCT=10.0
# Pause after N consecutive losing trades (0 = disabled).
C5_RISK_CONSEC_LOSS_LIMIT=5
# Pause if more than X% of the last N orders went unfilled (0 = disabled).
# High unfilled ratio means your pricing is wrong — the bot is bidding where
# the market won't fill.
C5_RISK_UNFILLED_RATIO=0.5
C5_RISK_UNFILLED_LOOKBACK=20
# Auto-resume after N minutes of risk pause (0 = stay paused until manual clear).
C5_RISK_AUTO_RESUME_MINUTES=60

# --- Edge Gate — minimum edge for directional trades (v0.3.0+) ---
# Require the model's probability (p) minus the market ask price (P) to be at
# least this much before placing a directional ML trade.
# Skipped for snipe trades (they use their own delta threshold).
# Set to 0 to disable. Recommended: 0.02–0.05.
C5_POLY_EDGE_MIN=0.03

# --- Smart Signal Tuning (v0.4.0+) ---
# Ensemble weight: how much to trust the model vs live Chainlink price delta.
# 1.0 = pure model, 0.0 = pure delta. Default 0.6 = 60% model, 40% delta.
# The Chainlink delta shows what's ALREADY happening in the 5-min window —
# blending it with the model improves accuracy because the market resolves
# on Chainlink, not Coinbase.
C5_ENSEMBLE_WEIGHT=0.6

# Quiet hours (UTC): skip ML-based trades during low-liquidity hours.
# Format: "START-END" in UTC hours (e.g., "20-04" skips 20:00–04:00 UTC).
# Snipe trades are NOT affected (they're oracle-based, not model-based).
# Leave blank to trade 24/7 (default).
C5_QUIET_HOURS_UTC=

# --- Auto-update ---
# Your bot checks for new versions automatically.
# These settings tell it WHERE to download updates from (the seller's server).
# If blank/missing, the app can use built-in defaults.
C5_UPDATE_SERVER_URL=http://65.109.240.249:8602
C5_UPDATE_KEY=drFE4mtZ8lypUsAezwicvVGu7hODfSaQ

# --- Update server (seller only — customers ignore this) ---
# Set to true ONLY on the seller's VPS to serve updates to customers.
# C5_UPDATE_SERVER=false
# C5_RELEASES_DIR=/app/releases
